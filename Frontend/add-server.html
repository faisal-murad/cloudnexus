<!doctype html>
<html lang="en">

<head>
   <!-- Required meta tags -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <title>CloudNexus</title>
   <!-- Favicon -->
   <link rel="shortcut icon" href="images/favicon.ico" />
   <!-- Bootstrap CSS -->
   <link rel="stylesheet" href="css/bootstrap.min.css">
   <!-- Typography CSS -->
   <link rel="stylesheet" href="css/typography.css">
   <!-- Style CSS -->
   <link rel="stylesheet" href="css/style.css">
   <!-- Responsive CSS -->
   <link rel="stylesheet" href="css/responsive.css">
   <!-- <script>
      if (!sessionStorage.getItem('email')) {
         window.location.href = 'sign-in.html';
      } 
   </script> -->
</head>

<body>
   <!-- loader Start -->
   <div id="loading">
      <div id="loading-center">
      </div>
   </div>
   <!-- loader END -->
   <!-- Wrapper Start -->
   <div class="wrapper">
      <div class="iq-top-navbar m-0" style="width: 100%;">
         <div class="iq-navbar-custom">
            <nav class="navbar navbar-expand-lg navbar-light p-0">
               <div class="navbar-breadcrumb">
                  <div class="iq-navbar-logo d-flex justify-content-between">
                     <a href="index.html" class="header-logo">
                        <img src="images/logo.png" class="img-fluid rounded-normal" alt="">
                        <div class="pt-2 pl-2 logo-title">
                           <span class="text-danger text-uppercase">Cloud<span
                                 class="text-primary ml-1">Nexus</span></span>
                        </div>
                     </a>
                     <!-- <h4 class="mb-0 text-dark">Dashboard</h4> -->
                  </div>
                  <p class="mb-0"><span class="text-danger">Hi there,</span> Great to see you again</p>
               </div>
               <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                  aria-controls="navbarSupportedContent" aria-label="Toggle navigation">
                  <i class="ri-menu-3-line"></i>
               </button>
               <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav ml-auto navbar-list">
                     <li class="nav-item nav-icon">
                        <div class="iq-search-bar">
                           <form action="#" class="searchbox">
                              <input type="text" class="text search-input" placeholder="Type here to search...">
                              <a class="search-link" href="#"><i class="ri-search-line"></i></a>
                           </form>
                        </div>
                     </li>
                     <li class="nav-item nav-icon">
                        <a href="#" class="search-toggle iq-waves-effect text-primary rounded">
                           <i class="ri-notification-line block"></i>
                           <span class="bg-danger dots"></span>
                        </a>
                        <div class="iq-sub-dropdown">
                           <div class="iq-card shadow-none m-0">
                              <div class="iq-card-body p-0">
                                 <div class="bg-primary p-3">
                                    <h5 class="mb-0 text-white">All Notifications<small
                                          class="badge  badge-light float-right pt-1">4</small></h5>
                                 </div>
                                 <a href="#" class="iq-sub-card">
                                    <div class="media align-items-center">
                                       <div class="">
                                          <img class="avatar-40 rounded" src="images/user/01.jpg" alt="">
                                       </div>
                                       <div class="media-body ml-3">
                                          <h6 class="mb-0 ">Emma Watson Barry</h6>
                                          <small class="float-right">Just Now</small>
                                          <p class="mb-0">95 MB</p>
                                       </div>
                                    </div>
                                 </a>
                                 <a href="#" class="iq-sub-card">
                                    <div class="media align-items-center">
                                       <div class="">
                                          <img class="avatar-40 rounded" src="images/user/02.jpg" alt="">
                                       </div>
                                       <div class="media-body ml-3">
                                          <h6 class="mb-0 ">New customer is join</h6>
                                          <small class="float-right">5 days ago</small>
                                          <p class="mb-0">Cyst Barry</p>
                                       </div>
                                    </div>
                                 </a>
                                 <a href="#" class="iq-sub-card">
                                    <div class="media align-items-center">
                                       <div class="">
                                          <img class="avatar-40 rounded" src="images/user/03.jpg" alt="">
                                       </div>
                                       <div class="media-body ml-3">
                                          <h6 class="mb-0 ">Two customer is left</h6>
                                          <small class="float-right">2 days ago</small>
                                          <p class="mb-0">Cyst Barry</p>
                                       </div>
                                    </div>
                                 </a>
                                 <a href="#" class="iq-sub-card">
                                    <div class="media align-items-center">
                                       <div class="">
                                          <img class="avatar-40 rounded" src="images/user/04.jpg" alt="">
                                       </div>
                                       <div class="media-body ml-3">
                                          <h6 class="mb-0 ">New Mail from Fenny</h6>
                                          <small class="float-right">3 days ago</small>
                                          <p class="mb-0">Cyst Barry</p>
                                       </div>
                                    </div>
                                 </a>
                              </div>
                           </div>
                        </div>
                     </li>
                  </ul>
               </div>
               <ul class="navbar-list">
                  <li class="line-height">
                     <a href="#" class="search-toggle iq-waves-effect d-flex align-items-center">
                        <img src="images/user/user.png" class="img-fluid rounded-circle" alt="user">
                     </a>
                     <div class="iq-sub-dropdown iq-user-dropdown">
                        <div class="iq-card shadow-none m-0">
                           <div class="iq-card-body p-0 ">
                              <div class="bg-primary p-3">
                                 <h5 id="profileMsg" class="mb-0 text-white line-height">Hello Barry Tech</h5>
                                 <span class="text-white font-size-12">Available</span>
                              </div>
                              <!-- <a href="profile.html" class="iq-sub-card iq-bg-primary-hover"> -->
                              <a href="profile-edit.html" class="iq-sub-card iq-bg-primary-hover">
                                 <div class="media align-items-center">
                                    <div class="rounded iq-card-icon iq-bg-primary">
                                       <i class="ri-file-user-line"></i>
                                    </div>
                                    <div class="media-body ml-3">
                                       <h6 class="mb-0 ">My Profile</h6>
                                       <p class="mb-0 font-size-12">View personal profile details.</p>
                                    </div>
                                 </div>
                              </a>
                              <a href="account-setting.html" class="iq-sub-card iq-bg-primary-hover">
                                 <div class="media align-items-center">
                                    <div class="rounded iq-card-icon iq-bg-primary">
                                       <i class="ri-account-box-line"></i>
                                    </div>
                                    <div class="media-body ml-3">
                                       <h6 class="mb-0 ">Account settings</h6>
                                       <p class="mb-0 font-size-12">Manage your account parameters.</p>
                                    </div>
                                 </div>
                              </a>
                              <!-- <a href="privacy-setting.html" class="iq-sub-card iq-bg-primary-hover">
                                 <div class="media align-items-center">
                                    <div class="rounded iq-card-icon iq-bg-primary">
                                       <i class="ri-lock-line"></i>
                                    </div>
                                    <div class="media-body ml-3">
                                       <h6 class="mb-0 ">Privacy Settings</h6>
                                       <p class="mb-0 font-size-12">Control your privacy parameters.</p>
                                    </div>
                                 </div>
                              </a> -->
                              <div class="d-inline-block w-100 text-center p-3">
                                 <a id="signout" class="bg-primary iq-sign-btn" href="sign-in.html" role="button">Sign
                                    out<i class="ri-login-box-line ml-2"></i></a>
                              </div>
                           </div>
                        </div>
                     </div>
                  </li>
               </ul>
            </nav>
         </div>
      </div>
      <!-- TOP Nav Bar END -->
      <!-- Page Content  -->
      <div id="content-page" class="content-page">
         <div class="container-fluid">
            <div class="row content-body">
               <div class="col-lg-12">

                  <div class="title-on-header text-center">

                     <h2 class="d-block mb-3 text-black">Add a new Server</h2>
                  </div>
                  <div class="iq-card iq-card-block iq-card-stretch iq-card-height iq-bg-primary">
                     <div class="iq-card-body box iq-box-relative welcome-box">
                        <h4 class="d-block mb-3 text-black">Execute the following commands in your terminal</h4>
                        <div class="iq-card p-3 container-flui bg-dark text-white">
                           <p id="cmd1" class="d-inline-block welcome-text">
                              wget
                              https://raw.githubusercontent.com/hammadkhaliq566/cloudnexus/main/cloudnexus_install.sh
                           </p>
                           <p id="cmd2" class="d-inline-block welcome-text">
                              sudo bash cloudnexus_install.sh Server-Id root
                           </p>
                        </div>
                        <h5>Supported Flavors : Ubuntu, Debian, RedHat, CentOS, Rocky Linux, Oracle Linux, AlmaLinux,
                           Amazon Linux, SUSE, Fedora, OSX, FreeBSD, IBM AIX, Raspberry Pi, Mandriva Linux, CoreOS,
                           Gentoo Linux and Oracle Solaris (x86_64 architecture only)</h5>
                     </div>
                  </div>
                  <h5 id="serverInstalled" style="color: green; text-align: center;"></h5>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!-- Wrapper END -->
   <!-- Footer -->
   <footer class="iq-footer m-0" style="width: 100%;">
      <div class="container-fluid">
         <div class="row">
            <div class="col-lg-6">
               <ul class="list-inline mb-0">
                  <li class="list-inline-item"><a href="privacy-policy.html">Privacy Policy</a></li>
                  <li class="list-inline-item"><a href="terms-of-service.html">Terms of Use</a></li>
               </ul>
            </div>
            <div class="col-lg-6 text-right">
               Copyright 2023 <a href="#">CloudNexus</a> All Rights Reserved.
            </div>
         </div>
      </div>
   </footer>
   <!-- Footer END -->

   <!-- Optional JavaScript -->
   <script src="./customJS/index-page.js"></script>

   <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
   <script>
      function downloadScreen() {
         // Get the element to capture
         const elementToCapture = document.getElementById('abc');

         // Use html2canvas to capture the element
         html2canvas(elementToCapture).then(canvas => {
            // Convert the canvas to a data URL
            const dataUrl = canvas.toDataURL();

            // Create a link and trigger a download
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = 'screenshot.png';
            a.click();
         });
      }
   </script>


   <script>
      let userSID;
      let user_SID_on_Login = sessionStorage.getItem('SID');
      console.log('user_SID_on_Login', user_SID_on_Login);
      const serverInstalled = document.getElementById('serverInstalled');

      async function sidResponse() {
         const tempp = {
            user_id: sessionStorage.getItem('user_id')
         };


         console.log('user_id add server page = ', user_id);
         try {
            const response = await fetch('http://localhost:3020/api/user/checkSid', {
               method: "POST",
               headers: {
                  'Content-Type': 'application/json'
               },
               body: JSON.stringify(tempp)
            });

            if (!response.ok) {
               throw new Error('Network Response was not OK');
            }

            const data = await response.json();

            console.log('Success', data);
            userSID = data.SID;

            console.log("user_SID_on_Login datatype:", typeof (user_SID_on_Login));
            console.log("userSID datatype:", typeof (userSID));

            if (user_SID_on_Login != userSID) {
               alert('Agent has been successfully installed!');
               // serverInstalled.innerText ='Agent has been successfully installed!';
               sessionStorage.setItem('SID', userSID);
               window.location.href = 'index.html';
            }
         } catch (error) {
            console.error('Error:', error);
         }
      }

      setInterval(sidResponse, 1000);
   </script>

   <!-- <script>
      const userName = sessionStorage.getItem('firstname');

      const welcomeMsg = document.getElementById('welcomeUser');
      const profileMsg = document.getElementById('profileMsg');

      welcomeMsg.innerText = "Welcome Back " + userName + "!";
      profileMsg.innerText = "Hello " + userName;
</script>
<script>
      const signout = document.getElementById('signout');

      signout.addEventListener('click', function (event) {
         event.preventDefault();
         sessionStorage.clear();

         window.location.href = "sign-in.html";

      })
      const printScreen = () => {
         window.print();
      }
   </script>
      <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
   
   function downloadScreen() {
   // Get the element to capture
   const elementToCapture = document.getElementById('abc');

   // Use html2canvas to capture the element
   html2canvas(elementToCapture).then(canvas => {
   // Convert the canvas to a data URL
   const dataUrl = canvas.toDataURL();

   // Create a link and trigger a download
   const a = document.createElement('a');
   a.href = dataUrl;
   a.download = 'screenshot.png';
   a.click();
   });
   }
</script>
   
</script>
   <script>

   document.addEventListener("DOMContentLoaded", function () {


   const handleDelete = async (serverId) => {
   try {
   const response = await fetch(`http://localhost:3020/api/user/deleteServer/${serverId}`, {
   method: "DELETE",
   headers: {
   'Content-Type': 'application/json'
   },
   });

   if (response.ok) {
   console.log('Server deleted successfully');
   } else {
   console.error('Failed to delete server:', response.status, response.statusText);
   }
   } catch (error) {
   console.error('Error during delete request:', error);
   }
   };



   let servers;
   const toSend = {
   _id: sessionStorage.getItem('user_id')
   };

   console.log("dfadfadsfa\n\n" + sessionStorage.getItem('user_id') + '\n\n\n\n');

   fetch('http://localhost:3020/api/user/getServers', {
   method: "POST",
   headers: {
   'Content-Type': 'application/json'
   },
   body: JSON.stringify(toSend)
   })
   .then(response => {
   if (!response.ok) {
   throw new Error('Network response was not ok');
   }
   return response.json();
   })
   .then(data => {
   servers = data;
   console.log('Success:', servers);

   const tableBody = document.querySelector('#serverTable');
   let html = "";

   servers.forEach(server => {


   const createdAt = new Date(server.createdAt).toLocaleDateString();
   // const createdAt = new Date(server.createdAt);
   // const currentDateTime = new Date();

   // const timeDifference = currentDateTime - createdAt;

   // // Convert milliseconds to seconds
   // const seconds = Math.floor(timeDifference / 1000);

   // // Define the thresholds for different time units
   // const thresholds = {
   // year: 31536000,
   // month: 2592000,
   // day: 86400,
   // hour: 3600,
   // minute: 60,
   // };

   // // Determine the appropriate human-readable format based on the duration
   // let durationText;

   // for (const [unit, threshold] of Object.entries(thresholds)) {
   // const value = Math.floor(seconds / threshold);
   // if (value >= 1) {
   // durationText = new Intl.RelativeTimeFormat('en', { numeric: 'auto' }).format(-value, unit);
   // break;
   // }
   // }

   html += `<tr id="serverTemplate" data-id="${server.id}">
      <td>
         <div class="avatar-40 text-center rounded-circle iq-bg-danger position-relative">
            <span class="font-size-20 align-item-center"><i class="fa fa-user" aria-hidden="true"></i><span
                  class="bg-success dots"></span></span>
         </div>
      </td>
      <td>
         <h6 id="serverName">${server.serverName}</h6>
         <span id="serverDetails" class="text-body font-weight-400">
            ${server.cpuUsage}</span>
      </td>
      <td id="serverIP">${server.ipAddress}</td>
      <td id="serverTime">${createdAt}</td>
      <td>
         <div id="serverTag" class="text-danger">${server.tag}</div>
      </td>
      <td></td>
      <td>
         <span class="text-black font-size-24" id="dropdownMenuButton3" style="cursor: pointer;" data-toggle="dropdown">
            <i class="ri-more-fill"></i>
         </span>
         <div class="dropdown-menu dropdown-menu-right shadow-none" aria-labelledby="dropdownMenuButton3">
            <a class="dropdown-item" href="#"><i class="ri-eye-fill mr-2"></i>View</a>
            <a class="dropdown-item" href="#" id="deleteButton" onClick="handleDelete('${server._id}')"><i
                  class="ri-delete-bin-6-fill mr-2"></i>Delete</a>
            <a class="dropdown-item" href="#"><i class="ri-pencil-fill mr-2"></i>Edit</a>
            <a class="dropdown-item" href="#"><i class="ri-printer-fill mr-2"></i>Print</a>
            <a class="dropdown-item" href="#"><i class="ri-file-download-fill mr-2"></i>Download</a>
         </div>
      </td>
   </tr>`;
   });

   tableBody.innerHTML = html;

</script>

<script>
   const deleteButton = document.getElementById("deleteButton");
   deleteButton.addEventListener("click", handleDelete);
   })
   .catch(error => {
   // Handle error
   console.error('Error:', error);
   });
   });

   </script> -->
   <!-- 
   <script>
      const codeText = document.getElementById('codeText');

      const randomCode = Math.floor(100000 + Math.random() * 900000);

      codeText.innerText = "Code = " + randomCode;

   </script> -->


   <script>
      const email = sessionStorage.getItem("email");



      const cmd1 = document.getElementById('cmd1');
      const cmd2 = document.getElementById('cmd2');
      const user_id = sessionStorage.getItem('user_id');
      const SID = sessionStorage.getItem('SID');
      const data = {
         "_id": user_id,
      }
      fetch('http://localhost:3020/api/user/FindOneUser', {
         method: 'POST',
         headers: {
            'Content-Type': 'application/json',
         },
         body: JSON.stringify(data),
      })
         .then(response => {
            if (!response.ok) {
               throw new Error('Network response was not ok');
            }
            return response.json();
         })
         .then(dataa => {
            // Handle successful response
            console.log('Executing JavaScript...');
            console.log('Success:', dataa);
            console.log('user_id msm = ', dataa._id);
            console.log('user_id msm = ', dataa.user_id);
            console.log('user_id msm = ', dataa.SID);


            cmd1.innerText = "wget https://raw.githubusercontent.com/hammadkhaliq566/cloudnexus/main/cloudnexus_install.sh";
            cmd2.innerText = `sudo bash cloudnexus_install.sh ${SID} ${user_id} root`;
         })
         .catch(error => {
            // Handle error  
            console.error('Error:', error);
         });  
   </script>


   <!-- jQuery first, then Popper.js, then Bootstrap JS -->
   <script src="js/jquery.min.js"></script>
   <script src="js/popper.min.js"></script>
   <script src="js/bootstrap.min.js"></script>
   <!-- Appear JavaScript -->
   <script src="js/jquery.appear.js"></script>
   <!-- Countdown JavaScript -->
   <script src="js/countdown.min.js"></script>
   <!-- Counterup JavaScript -->
   <script src="js/waypoints.min.js"></script>
   <script src="js/jquery.counterup.min.js"></script>
   <!-- Wow JavaScript -->
   <script src="js/wow.min.js"></script>
   <!-- Apexcharts JavaScript -->
   <script src="js/apexcharts.js"></script>
   <!-- Slick JavaScript -->
   <script src="js/slick.min.js"></script>
   <!-- Select2 JavaScript -->
   <script src="js/select2.min.js"></script>
   <!-- Owl Carousel JavaScript -->
   <script src="js/owl.carousel.min.js"></script>
   <!-- Magnific Popup JavaScript -->
   <script src="js/jquery.magnific-popup.min.js"></script>
   <!-- Smooth Scrollbar JavaScript -->
   <script src="js/smooth-scrollbar.js"></script>
   <!-- lottie JavaScript -->
   <script src="js/lottie.js"></script>
   <!-- am core JavaScript -->
   <script src="js/core.js"></script>
   <!-- am charts JavaScript -->
   <script src="js/charts.js"></script>
   <!-- am animated JavaScript -->
   <script src="js/animated.js"></script>
   <!-- am Dark JavaScript -->
   <script src="js/dark.js"></script>
   <!-- am Dark JavaScript -->
   <script src="js/dark.js"></script>
   <!-- am kelly JavaScript -->
   <script src="js/kelly.js"></script>
   <!-- am maps JavaScript -->
   <script src="js/maps.js"></script>
   <!-- am worldLow JavaScript -->
   <script src="js/worldLow.js"></script>
   <!-- Raphael-min JavaScript -->
   <script src="js/raphael-min.js"></script>
   <!-- Morris JavaScript -->
   <script src="js/morris.js"></script>
   <!-- Morris min JavaScript -->
   <script src="js/morris.min.js"></script>
   <!-- Flatpicker Js -->
   <script src="js/flatpickr.js"></script>
   <!-- Style Customizer -->
   <script src="js/style-customizer.js"></script>
   <!-- Chart Custom JavaScript -->
   <script src="js/chart-custom.js"></script>
   <!-- Custom JavaScript -->
   <script src="js/custom.js"></script>



</body>

</html>